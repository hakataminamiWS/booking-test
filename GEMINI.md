# GEMINI.md

## プロジェクト概要

-   予約サービスを提供する Web アプリケーション
-   マルチテナント型予約サービスとして設計する。
-   基本は MPA (Laravel + Blade)、一部を Vue + Vuetify (TypeScript) で動的実装

## 技術スタック

-   バックエンド: Laravel + Blade
-   フロントエンド: Vue 3 + Vuetify + TypeScript
-   データベース: 単一 DB + `shop_id` スコープ管理（将来的に DB 分離型マルチテナントへ拡張可能）

## アーキテクチャ詳細

システムの技術的な設計方針（アーキテクチャ、認可、データモデルなど）については、[ARCHITECTURE.md](./docs/ARCHITECTURE.md) を参照してください。

## 開発ルール

-   Vuetify コンポーネントを優先利用
-   Vue コンポーネントは SFC (Single File Component)
-   TypeScript を利用し型安全を担保
-   **ドキュメントファースト**: コードを記述する前に、まず`docs/`配下に仕様書や設計書を作成・更新し、内容を確認する。
-   **実装計画**: ドキュメントの確認後、その内容を正として実装コードの計画を提示する。
-   **実装**: 実装コードの計画提示後、問題の無い内容であれば、その内容を正としてコードの新規作成、更新、削除を行う。

### 情報収集の基本方針

-   **Laravel に関する疑問**: まず `mcp laravel boost` を利用して解決を試みます。
-   **Vuetify に関する疑問**: まず `mcp vuetify` を利用して解決を試みます。
-   上記で解決しない場合に限り、Web 検索などのより広範な情報収集を行います。この方針は、プロジェクト固有のツール設定やバージョンに最適化された、正確かつ効率的な開発を維持するために重要です。

## TODO (機能一覧)

### 利用者機能（機能要件チェック）

#### 予約受付

-   [ ] Web 予約フォーム（スマホ対応）
-   [ ] カレンダーから空き時間選択
-   [ ] スタッフ指名（任意）
-   [ ] 性別希望選択（任意）
-   [ ] メニューごとの所要時間自動反映
-   [ ] 予約内容の確認ページ
-   [ ] 自動返信メール送信

#### 営業時間・定休日管理

-   [ ] 営業日／休業日設定
-   [ ] 特別営業日（祝日営業など）の個別設定
-   [ ] スタッフごとのシフト登録（個別スケジュール）

#### キャンセル・変更

-   [ ] 予約変更・キャンセル可能な期限設定（例：24 時間前まで）
-   [ ] （課題）キャンセル待ち登録（任意）

#### 通知・リマインダー

-   [ ] 予約確定・変更・キャンセル通知（メール）
-   [ ] 予約確定・変更・キャンセル通知（LINE）
-   [ ] 予約確定・変更・キャンセル通知（SMS）
-   [ ] （課題）来店前日のリマインダー

#### スタッフ管理

-   [ ] スタッフごとの予約枠管理
-   [ ] （課題）スタッフプロフィール・写真表示（指名予約向け）

---

### システム機能（設計観点）

#### 認証・アカウント管理

-   [ ] Booker 認証 (Google/LINE OIDC)
-   [ ] Owner/Staff 認証 (Google OIDC 前提)
-   [ ] ゲスト予約対応（ログインなし予約）
-   [ ] 契約状態管理 (有効/無効/期限切れ)

#### マルチテナント

-   [ ] shop モデル設計（UUID キー）
-   [ ] owner と shop の 1 対多 関係
-   [ ] staff と shop の 関係管理
-   [ ] booker と shop の 関係管理

#### 予約者 (Booker) 管理

-   [ ] ゲスト予約時に自動 booker 作成 (shop_id + uuid)
-   [ ] booker 統合処理（bookings.booker_id 更新）
-   [ ] 古い booker の論理削除 (is_active=false)
-   [ ] 統合ログ（誤統合リカバリ用）

#### 予約 (Booking) 管理

-   [ ] 予約ステータス管理 (pending/confirmed/canceled)
-   [ ] 予約者情報 (name, email, tel) を bookings に保持
-   [ ] オーナー・スタッフ用予約一覧 (フィルタ/ソート)

#### オーナー機能

-   [ ] 複数店舗の管理画面（店舗一覧 → 店舗詳細）
-   [ ] 予約者一覧・予約一覧の確認
-   [ ] 契約状態の管理 (契約更新/停止)

#### 通知（技術的実装）

-   [ ] Google アカウント経由でのメール送信
-   [ ] LINE Messaging API 対応
-   [ ] SMS API 対応 (Twilio 等)
