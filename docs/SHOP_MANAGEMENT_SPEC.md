# 店舗管理機能仕様書

このドキュメントは、店舗管理機能のUI/UX、APIエンドポイント、およびデータインタラクションに関する詳細な仕様を定義します。
**（注: 本仕様は、オーナーが自身の契約に基づき店舗を作成する新しい設計（パターンA）に基づいています）**

## 1. 目的

店舗管理機能の設計と実装において、関係者間の共通認識を確立することを目的とします。

## 2. 対象ユーザー

-   Owner (店舗オーナー)

## 3. 機能概要

オーナーは、自身の契約で許可された上限数の範囲内で、店舗情報の登録、閲覧、更新、削除ができます。

## 4. 画面仕様詳細

### 4.1. 店舗一覧画面

-   **URL**: `/owner/shops`
-   **UI要素**:
    -   自身が所有する店舗の一覧を表示。
    -   **新規店舗登録ボタン**:
        -   オーナーの契約上限 (`contracts.max_shops`) に達していない場合にのみ表示される。

### 4.2. 店舗登録画面

-   **URL**: `/owner/shops/create`
-   **UI要素**:
    -   店舗情報の入力フォーム（店舗名、各種設定など）。
    -   保存ボタン。

### 4.3. 店舗編集画面

-   **URL**: `/owner/shops/{shop}`
-   **UI要素**:
    -   既存の店舗情報の編集フォーム。
    -   保存ボタン、削除ボタン。

## 5. API設計

### 5.1. 店舗一覧取得

-   **エンドポイント**: `GET /api/owner/shops`
-   **レスポンス**: 自身が所有する店舗情報のリスト (JSON)

### 5.2. 店舗詳細取得

-   **エンドポイント**: `GET /api/owner/shops/{shop}`
-   **レスポンス**: 単一の店舗情報 (JSON)

### 5.3. 店舗登録

-   **エンドポイント**: `POST /api/owner/shops`
-   **リクエストボディ**: 新規店舗情報
-   **レスポンス**: 登録された店舗情報 (JSON)

### 5.4. 店舗更新

-   **エンドポイント**: `PUT /api/owner/shops/{shop}`
-   **リクエストボディ**: 更新する店舗情報
-   **レスポンス**: 更新された店舗情報 (JSON)

### 5.5. 店舗削除

-   **エンドポイント**: `DELETE /api/owner/shops/{shop}`
-   **レスポンス**: 成功/失敗を示すメッセージ

## 6. 認可 (Authorization)

-   **`ShopPolicy`** を利用して認可を制御します。
    -   **`viewAny`, `view`, `update`, `delete`**:
        -   対象の店舗 (`Shop`) の `owner_user_id` が、操作を実行しようとしているユーザーのIDと一致するかどうかを確認します。
    -   **`create`**:
        -   ユーザーが有効な契約 (`contracts`) を持っているかを確認します。
        -   ユーザーが既に所有している店舗数が、契約の店舗上限 (`contracts.max_shops`) に達していないことを確認します。

## 7. データモデルとの関連

-   `Shop` モデル (`owner_user_id` を含む)
-   `User` モデル (Owner)
-   `Contract` モデル (`max_shops` を含む)