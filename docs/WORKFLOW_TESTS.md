# ワークフロー自動テストガイド

このドキュメントは、システムのコアな業務フローが正しく機能することを保証するために用意された、自動テストについて説明します。

## 1. オーナー新規契約ワークフローテスト

### 1.1. 目的

`OWNER_ONBOARDING_WORKFLOW.md` で定義された、新しいオーナーが契約を経て店舗作成権限を得るまでの一連のフローが、バックエンドの権限ロジック (`ShopPolicy`) と整合性が取れていることを自動的に検証します。

### 1.2. テストファイル

-   `tests/Feature/WorkflowTest.php`

### 1.3. 実行方法

プロジェクトのルートディレクトリで、以下のArtisanコマンドを実行してください。

```bash
php artisan test tests/Feature/WorkflowTest.php
```

### 1.4. テスト内容

このテストは、内部で以下のようなシナリオを実行し、権限が正しく付与されるかを確認しています。

1.  テスト用のデータベースを準備し、シーダーを実行してテストユーザーを作成します。
2.  オーナー候補となるユーザー（予約者ロール）を取得します。
3.  **契約前**: そのユーザーが店舗作成権限を**持っていない**ことを表明(assert)します。
4.  テストコード内で、そのユーザーのための契約(`contracts`)レコードを擬似的に作成します。
5.  **契約後**: ユーザーの情報を再読み込みした後、今度は店舗作成権限を**持っている**ことを表明(assert)します。

テストが成功すれば、現在のワークフローと権限ロジックが正しく連携して動作していることが保証されます。
