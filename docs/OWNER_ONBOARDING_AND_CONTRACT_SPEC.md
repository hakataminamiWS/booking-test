# オーナーオンボーディングと契約管理仕様書

このドキュメントは、新規オーナーのオンボーディングフロー、管理者によるオーナー登録と店舗紐付け、および契約管理に関する初期の仕様を定義します。

## 1. オーナーオンボーディングフロー (初期想定)

新規オーナーがシステムを利用開始するまでの初期フローは以下の通りです。

1.  **契約申し込み用画面へのログイン:**
    *   新規オーナーは、Google アカウントを使用して契約申し込み用の画面にログインします。
    *   ログインが成功すると、システムにユーザーとして登録されます。
    *   この際、Google から発行されたユーザーID等の情報は `user_oauth_identities` テーブルに保存されます。

2.  **申込フォームの表示と入力:**
    *   ログイン成功後、オーナーに申込フォームが表示されます。
    *   オーナーは以下の必要事項をフォームに記入します。
        *   店舗の数 (希望)
        *   メールアドレス
        *   電話番号
        *   オーナーの名前
    *   フォームには、隠し要素として、ログイン時にシステムに割り当てられたユーザー ID も同時にポストされます。

3.  **フォーム送信と管理者への通知:**
    *   オーナーがフォームを送信すると、予約システムの管理者へメールで通知が届きます。
    *   このメールには、申込フォームの内容と、オーナーのユーザー ID が含まれます。

## 2. 管理者によるオーナー登録と店舗紐付け

オーナーからの申し込みメールを受信後、管理者は以下の手順でオーナー登録と店舗紐付けを行います。

1.  **オーナーの確認と登録:**
    *   管理者は、受信したメール情報と、オーナーがログイン時にシステムに登録されたユーザー ID を元に、システムに登録されているユーザーをオーナーとして認識します。
    *   管理画面から、そのユーザーを正式にオーナーとして「登録」します。
        *   これは、`shop_user_role` テーブルに `owner` ロールで紐付けることで実現します。

2.  **店舗の作成と紐付け:**
    *   管理者は、オーナーの申し込み内容（希望する店舗数など）に基づき、管理画面から新しい店舗を作成します。
    *   作成した店舗を、当該オーナーに紐付けます。

## 3. 契約管理

オーナーと店舗の紐付けは、契約として管理されます。契約には以下の情報が含まれます。

*   **契約ステータス:**
    *   契約の現在の状態を示します (例: `active`, `inactive`, `pending`, `expired` など)。
*   **有効期限:**
    *   契約の開始日と終了日を管理します。

### 3.1. データモデル

上記の契約管理は、`DATABASE_SCHEMA.md`で定義されている以下のテーブルによって実現されます。

*   **`users` テーブル:**
    *   オーナーのアカウント情報を保持します。
*   **`user_oauth_identities` テーブル:**
    *   Googleアカウントでのログイン情報を保持します。
*   **`contracts` テーブル:**
    *   `user_id` (オーナー) と `shop_id` (店舗) を紐付け、契約期間やステータスを管理します。

