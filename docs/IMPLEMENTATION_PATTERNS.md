# 実装パターンガイド

このドキュメントは、本プロジェクトで繰り返し現れるUIや機能について、一貫性を保ち、効率的に開発を進めるための標準的な実装パターンを定義します。

---

## 動的な一覧画面の実装パターン

検索やページネーションを持つすべての一覧画面は、UXと開発効率を両立するため、以下のハイブリッド方針で実装することを原則とします。

### 1. 目的

ページ全体のリロードを伴わない快適なフィルタリング・ページネーション操作を提供しつつ、URLによる状態保持（ブラウザバック対応、URL共有）を可能にする。

### 2. 基本方針

初回読み込みはLaravel(サーバーサイド)で行い、フィルタリングやページネーションなどの動的な操作はVue(クライアントサイド)が担当する。

### 3. 実装フロー

以下に、`{Role}`（例: Admin, Owner）配下の`{Resource}`（例: User, Contract）というリソースの一覧画面を実装する場合の具体的な手順を示します。

#### 3.1. バックエンド (Laravel)

##### 3.1.1. APIコントローラの作成

1.  **コントローラ作成:**
    -   `app/Http/Controllers/Api/{Role}/{Resource}Controller.php` のように、API用のコントローラを専用ディレクトリに作成します。
    -   画面表示を担当する既存の `App\Http\Controllers\{Role}\{Resource}Controller` は変更しません。

2.  **ロジック実装:**
    -   新しい `{Resource}Controller` に `index` メソッドを作成します。
    -   `index` メソッドには、既存の画面表示用コントローラから、クエリ（絞り込み、ページネーション）のロジックをコピーして実装します。
    -   `index` メソッドの戻り値は `response()->json($paginator)` とし、ページネーション情報を含んだJSONを返却します。
    -   **注意:** ページネーションの表示件数は、ユーザー体験の一貫性を保つため、画面表示用コントローラと必ず同じ値に設定します。

##### 3.1.2. ルートの追加

-   `routes/web.php`内のAPIグループ (`Route::prefix('api')...`) の中に、以下の形式でルート定義を追加します。

```php
// 例: {Role}がAdmin, {Resource}がUserの場合
Route::get('/admin/users', [App\Http\Controllers\Api\Admin\UserController::class, 'index'])->name('admin.users.index');
```

#### 3.2. フロントエンド (Vue)

##### 3.2.1. Vueコンポーネントの責務

-   `props`で渡されるデータは**初期表示用**としてのみ利用します。
-   コンポーネント内に、APIから取得したデータを保持するためのリアクティブなローカル状態（`ref`）を定義します。（例: `localUsers`）

##### 3.2.2. データ取得メソッドの作成

-   `fetch{Resource}s` のような責務の明確な名前で、非同期のデータ取得メソッドをコンポーネント内に作成します。
-   このメソッドは以下の処理を担当します。
    1.  現在のフィルタ条件やページ番号からクエリ文字列を構築する。
    2.  `axios`を使い、対応するAPIエンドポイント（例: `/api/admin/users`）に非同期GETリクエストを送信する。
    3.  リクエスト成功後、返却されたJSONデータでローカル状態を更新し、画面を動的に再描画する。
    4.  ブラウザの**History API** (`history.pushState`) を使い、ページをリロードせずにURLを更新する。

##### 3.2.3. イベントハンドリング

-   **検索:** フォームによるGET送信を行わず、検索ボタンの`@click`イベントや、入力フィールドの`@keydown.enter`イベントでデータ取得メソッドを呼び出します。
-   **ページネーション:** `location.href`による画面遷移を行わず、`@input`や`@update:modelValue`イベントで、指定されたページ番号を引数にデータ取得メソッドを呼び出します。

##### 3.2.4. 初期化処理

-   コンポーネントのマウント時 (`onMounted`フックなど) に、`window.location.search`からURLのクエリパラメータを読み取り、フィルタの初期状態をセットします。
-   これにより、ブラウザバックで画面に戻った際に、フィルタリング状態が正しく復元されます。

##### 3.2.5. テンプレートの構成

Vueコンポーネントのテンプレートは、以下の構成を標準とします。

1.  **検索・フィルタコントロール**
2.  **ページネーション (`<v-pagination>`)**
    -   データテーブルの**上**に配置します。
    -   `total-visible` プロパティを `5` に設定し、「最初」「最後」「現在」「現在の前」「現在の後」のページリンクが表示されるようにします。
3.  **件数表示テキスト** (例: 全 XX 件中 X-X 件表示)
4.  **データテーブル (`<v-data-table>`)**
