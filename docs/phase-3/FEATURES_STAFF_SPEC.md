# スタッフ機能仕様書

## 1. 目的

このドキュメントは、スタッフ候補者、および店舗スタッフが利用する機能の UI/UX、API エンドポイント、およびデータインタラクションに関する詳細な仕様を定義します。

## 2. 対象ユーザー

-   スタッフ候補者
-   店舗スタッフ

---

## 3. 機能・画面仕様詳細

### スタッフ登録申し込み画面

#### 機能概要

スタッフ候補者が、店舗へのスタッフ登録を申請するための情報を入力する画面です。オーナーから共有された招待 URL にアクセスすると表示されます。

-   ユーザーがスタッフ登録の申し込み情報を入力・送信できる。
-   入力内容は `shop_staff_applications` テーブルに保存され、オーナーによる確認対象となる。
-   この時点では `shop_staffs` テーブルのレコードは作成しない。

#### 対象ユーザー

-   スタッフ候補者 (店舗へのスタッフ登録を希望するユーザー)

#### 画面仕様詳細 (`/shops/{shop:slug}/staff/apply`)

##### 表示項目一覧

-   非表示項目: user_id
-   表示項目: 店舗名
-   入力フォーム: 表示名
-   ボタン: 「申し込みを送信する」

| 項目    | 必須 | 型     | 備考                       |
| :------ | :--- | :----- | :------------------------- |
| user_id | ○    | hidden | ログインセッションから取得 |
| 店舗名  | ○    | string | 申し込み先の店舗名を表示   |
| 表示名  | ○    | string | フォーム入力               |

---

#### バックエンド仕様

##### データ受け渡し

-   コントローラでセッションから `user_id` を取得。
-   ルートモデルバインディングで `Shop` を取得し、店舗名を表示用にビューに渡す。
-   CSRF トークンを blade → Vue に渡す。
-   渡す方法は`docs/phase-3/ARCHITECTURE.md` の方法に従う。

##### フォーム送信

-   送信先: `POST /shops/{shop:slug}/staff/apply`
-   送信項目:
    -   user_id（hidden）
    -   name
    -   CSRF トークン

##### バリデーション

-   フロントエンド:
    -   必須項目チェック
-   バックエンド (FormRequest: `App\Http\Requests\Staff\StoreApplicationRequest`):
    -   認可チェック（未登録のユーザーであることなど）
    -   必須項目チェック (`name`)
    -   セッションの `user_id` と POST データの `user_id` の一致確認

##### 処理内容

このフォーム送信の時点では、`shop_staffs`テーブルへのレコード作成は行わない。あくまでオーナーによるスタッフ登録作業を依頼するための「申し込み」として扱う。

1.  バリデーション成功時:
    -   `shop_staff_applications` テーブルに登録。
    -   完了ページへリダイレクトし、「店舗スタッフへの申し込みが完了しました。オーナーからの承認をお待ちください。」と表示。
2.  バリデーション失敗時:
    -   画面遷移せず、エラーメッセージを表示。

##### API エンドポイント

    スタッフ登録申し込みフォームに関する API エンドポイントは提供しない。
