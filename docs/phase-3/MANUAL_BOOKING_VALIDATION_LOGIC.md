# 手動予約登録時のバリデーションロジック

## 1. 概要

このドキュメントは、店舗スタッフやオーナーが管理画面から手動で予約を登録・編集する際のバリデーション（入力チェック）ロジックを定義します。

お客様向けのオンライン予約で提示される厳密な予約可能時間枠（`AVAILABILITY_CALCULATION_LOGIC.md`を参照）とは異なり、店舗側の裁量による柔軟な予約登録（例：営業時間外の特例対応）を可能にすることを目的とします。

---

## 2. 基本方針

- **警告を主とし、登録をブロックするのは最小限に留める。**
- ユーザー（スタッフ/オーナー）に最終的な判断を委ねるUI（例：「営業時間外ですが、本当に登録しますか？」という確認ダイアログ）と連携することを前提とします。

---

## 3. バリデーション項目と挙動

### TODO

#### 1. 必須項目の入力チェック (ブロック)
- 予約日時、メニュー、予約者名などの必須項目が入力されていることをチェックします。

#### 2. 時間に関するチェック (警告)
以下の条件に該当する場合、確認ダイアログ等で警告を表示しますが、ユーザーが許可すれば登録は可能です。

- **店舗の営業時間外・定休日**:
  - 予約時間が、`shop_business_hours_regulars`, `shop_special_open_days`, `shop_special_closed_days` で定義された営業時間外または休業日に設定されていないかチェックします。

- **担当スタッフのシフト外**:
  - 割り当てられたスタッフの `shop_staff_schedules` （シフト）の時間外に予約が設定されていないかチェックします。

- **既存予約との重複**:
  - 割り当てられたスタッフの、同じ時間帯に別の `bookings` レコードが存在しないかチェックします。

#### 3. 整合性に関するチェック (警告)

- **メニューと担当スタッフの不一致**:
  - 選択されたメニューが、割り当てられたスタッフの担当可能メニュー (`shop_menu_staffs`) に含まれているかチェックします。

具体的な警告メッセージやUIの挙動については、今後詳細を定義します。
